# ZenPub v2.4.0 版本更新说明

## 主要变更

### 🗑️ 缓存系统移除
- **彻底移除缓存系统**: 完全删除了状态缓存、IndexedDB存储和相关组件
- **简化架构**: 移除了复杂的缓存逻辑，专注于核心编辑功能
- **提升稳定性**: 消除了因缓存导致的状态不一致问题

### 🎨 UI/UX 改进
- **暗色模式优化**: 统一左侧目录和右侧预览区的背景色、文字色，确保视觉一致性
- **独立字号控制**: 为输入区和预览区分别提供独立的字号控制选项
  - 编辑器字号范围: 10-24px
  - 预览区字号范围: 12-24px
  - 每个区域可以独立调整，满足不同使用场景需求

### 🧹 智能替换功能
- **Markdown语法识别**: 优化替换功能算法，智能识别并跳过Markdown语法标记
- **保护格式**: 替换时自动跳过以下Markdown元素:
  - 标题 (`#`, `##`, `###`)
  - 强调 (`**加粗**`, `*斜体*`)
  - 链接 (`[文本](URL)`)
  - 图片 (`![描述](URL)`)
  - 代码 (行内 ``代码``, 代码块 `````)
  - 引用 (`> 引用文本`)
  - 列表 (`- 项目`, `1. 项目`)
  - 分割线 (`---`)
- **替换计数**: 智能统计实际替换次数，提供准确的反馈

### 🏗️ 架构优化
- **组件精简**: 移除了 `cacheService.ts`、`useAppCache.ts` 和 `RestorePrompt.tsx`
- **Service Worker 简化**: 重写为极简版本，仅保留PWA基础功能
- **性能提升**: 减少了不必要的数据持久化操作，提升响应速度

## 技术细节

### 移除的文件
- `/services/cacheService.ts` - 缓存服务
- `/hooks/useAppCache.ts` - 应用缓存Hook
- `/components/RestorePrompt.tsx` - 恢复提示组件

### 修改的文件
- `/public/sw.js` - 简化为无缓存版本
- `/public/manifest.webmanifest` - 更新描述
- `/App.tsx` - 移除缓存相关代码，添加编辑器配置
- `/types.ts` - 添加 EditorConfig 类型
- `/index.html` - 简化Service Worker注册代码

### 新增功能
- **编辑器配置** (`EditorConfig`类型): 包含字号、行高和制表符设置
- **智能替换算法**: 基于Markdown语法的智能文本替换

## 向后兼容性

- ✅ 无兼容性问题，现有项目文件不受影响
- ✅ 导出功能 (EPUB, PDF, Markdown) 保持不变
- ✅ 快捷键和用户界面基本布局保持不变

## 测试用例

### 字号控制测试
1. 打开任意文档
2. 点击编辑器工具栏中的 `+/-` 按钮调整编辑器字号
3. 确认编辑器文本大小立即变化
4. 切换到预览模式，调整预览区字号
5. 确认预览区文本大小独立变化

### 智能替换测试
1. 创建包含Markdown语法的测试文本:
   ```markdown
   # 标题
   
   这是一个包含**加粗**和*斜体*的段落。
   
   ## 副标题
   
   > 这是引用
   
   - 列表项
   - 另一个列表项
   
   [链接文本](https://example.com)
   
   ---
   ```
2. 尝试替换文本中的普通内容
3. 确认Markdown语法标记未被替换
4. 确认普通文本内容被正确替换
5. 检查替换计数是否准确

### 暗色模式测试
1. 切换到暗色模式
2. 确认左侧目录和右侧预览区背景色一致
3. 检查文字对比度是否合适
4. 测试在不同预览模式(A4/移动/桌面)下的显示效果

## 未来规划

- v2.4.1: 添加更多Markdown编辑增强功能
- v2.4.2: 优化移动端体验和触摸操作
- v2.4.3: 增加插件系统支持

---

*ZenPub - 专注于简洁高效的Markdown编辑体验*